<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SHADT - Estadía y Alta Paciente</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="css/styles.css">

  <style>
    .beds-grid {
      text-align: center;
    }

    .bed-slot {
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .bed-slot:hover {
      transform: translateY(-3px);
    }

    .bed-img {
      max-width: 90px;
      height: auto;
    }

    .bed-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: #181010;
      text-shadow: 0 0 4px rgba(0,0,0,0.7);
    }

    .panel-info {
      background-color: rgba(255,255,255,0.9);
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 0.9rem;
    }

    .panel-info-title {
      font-weight: 700;
      margin-bottom: 6px;
      text-transform: uppercase;
      font-size: 0.9rem;
    }
  </style>
</head>
<body class="app-body">

<!-- BOTÓN MENU LATERAL (solo móvil) -->
<button
  id="sidebarToggle"
  type="button"
  class="btn btn-primary d-md-none sidebar-toggle-btn"
  aria-label="Abrir menú"
>
  ☰
</button>

<div class="d-flex">

  <!-- SIDEBAR -->
  <aside class="sidebar bg-dark text-white">
    <div class="p-3 text-center border-bottom border-secondary">
      <div class="shadt-logo-side mb-1">SHADT</div>
    </div>

    <nav class="nav flex-column p-2 mt-2">
      <span class="text-uppercase text-muted small mb-2">Módulos</span>
      <a href="admision.html" class="nav-link text-white">ADMISIÓN</a>
      <a href="signos_vitales.html" class="nav-link text-white">SIGNOS VITALES</a>
      <a href="historia_clinica.html" class="nav-link text-white">HISTORIA CLÍNICA</a>
      <a href="salida.html" class="nav-link text-white">SALIDA</a>
      <a href="acostar.html" class="nav-link text-white">ACOSTAR</a>
      <a href="estadia_alta.html" class="nav-link text-white active">ESTADÍA Y ALTA PACIENTE</a>
      <a href="informes.html" class="nav-link text-white">INFORMES</a>
    </nav>

    <div class="mt-auto p-3 border-top border-secondary small">
      <div>Usuario: <strong id="shadt-username">Desarrollador</strong></div>
      <a href="modulos.html" class="text-decoration-none text-light d-block mb-1">
        Ir a módulos
      </a>
      <a href="index.html" class="text-decoration-none text-danger">
        Cerrar sesión
      </a>
    </div>
  </aside>

  <!-- CONTENIDO -->
  <main class="flex-grow-1 app-main app-bg-medico">
    <div class="container py-4">

      <div class="card bg-semitransparent">
        <div class="card-body">

          <div class="row g-3">
            <!-- CAMAS -->
            <div class="col-lg-8 beds-grid">
              <div class="row g-4 mb-3">
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(1)">
                    <img id="bed-img-1" src="img/cama-vacia.png" class="bed-img" alt="Cama 1">
                    <div class="bed-name mt-1">Cama 1</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(2)">
                    <img id="bed-img-2" src="img/cama-azul-vacia.png" class="bed-img" alt="Cama 2">
                    <div class="bed-name mt-1">Cama 2</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(3)">
                    <img id="bed-img-3" src="img/cama-azul-vacia.png" class="bed-img" alt="Cama 3">
                    <div class="bed-name mt-1">Cama 3</div>
                  </div>
                </div>
              </div>

              <div class="row g-4">
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(4)">
                    <img id="bed-img-4" src="img/cama-azul-vacia.png" class="bed-img" alt="Cama 4">
                    <div class="bed-name mt-1">Cama 4</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(5)">
                    <img id="bed-img-5" src="img/cama-azul-vacia.png" class="bed-img" alt="Cama 5">
                    <div class="bed-name mt-1">Cama 5</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bed-slot" onclick="selectBed(6)">
                    <img id="bed-img-6" src="img/cama-azul-vacia.png" class="bed-img" alt="Cama 6">
                    <div class="bed-name mt-1">Cama 6</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- PANEL DE INFORMACIÓN -->
            <div class="col-lg-4">
              <div class="panel-info">
                <div class="panel-info-title">Datos del paciente</div>
                <p class="mb-1"><strong>Cama:</strong> <span id="info-cama">Ninguna</span></p>
                <p class="mb-1"><strong>Nombre:</strong> <span id="info-nombre">Sin paciente asignado</span></p>
                <p class="mb-1"><strong>Tipo paciente:</strong> <span id="info-tipo">-</span></p>
                <p class="mb-1"><strong>Tipo cama:</strong> <span id="info-tipocama">-</span></p>
                <p class="mb-1"><strong>Documento:</strong> <span id="info-doc">-</span></p>

                <hr>

                <button type="button" class="btn btn-danger btn-sm" onclick="darAlta()">
                  Dar de alta
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </main>

</div>

<script>
  // Carga inicial de camas desde localStorage
  let beds = {};
  const bedImages = {
    none: 'img/cama-vacia.png',
    adulto: 'img/cama-adulto.png',
    nino: 'img/cuna-bebe.png',
    embarazada: 'img/cama-embarazada.png'
  };

  let currentBed = null;

  function initBeds() {
    const stored = localStorage.getItem('shadt_camas');
    beds = stored ? JSON.parse(stored) : {};

    // Asegurar 6 camas
    for (let i = 1; i <= 6; i++) {
      if (!beds[i]) {
        beds[i] = { type: 'none', patient: null };
      }
      actualizarCama(i);
    }
  }

  function actualizarCama(id) {
    const bed = beds[id];
    const img = document.getElementById('bed-img-' + id);
    if (img) {
      img.src = bedImages[bed.type] || bedImages.none;
    }
  }

  function selectBed(id) {
    currentBed = id;
    actualizarPanel();
  }

  function actualizarPanel() {
    const infoCama = document.getElementById('info-cama');
    const infoNombre = document.getElementById('info-nombre');
    const infoTipo = document.getElementById('info-tipo');
    const infoTipoCama = document.getElementById('info-tipocama');
    const infoDoc = document.getElementById('info-doc');

    if (!currentBed) {
      infoCama.textContent = 'Ninguna';
      infoNombre.textContent = 'Sin paciente asignado';
      infoTipo.textContent = '-';
      infoTipoCama.textContent = '-';
      infoDoc.textContent = '-';
      return;
    }

    const bed = beds[currentBed];
    infoCama.textContent = 'Cama ' + currentBed;

    if (bed.patient) {
      infoNombre.textContent = bed.patient.nombre;
      infoTipo.textContent = bed.patient.tipoPaciente === 'nino'
        ? 'Niño'
        : (bed.patient.tipoPaciente === 'adulto' ? 'Adulto' : 'Embarazada');
      infoTipoCama.textContent = bed.patient.tipoCama || '-';
      infoDoc.textContent = (bed.patient.tipoId || '') + ' ' + (bed.patient.numId || '');
    } else {
      infoNombre.textContent = 'Sin paciente asignado';
      infoTipo.textContent = '-';
      infoTipoCama.textContent = '-';
      infoDoc.textContent = '-';
    }
  }

  function darAlta() {
    if (!currentBed) {
      alert('Selecciona primero una cama.');
      return;
    }

    beds[currentBed] = { type: 'none', patient: null };
    actualizarCama(currentBed);
    actualizarPanel();
    localStorage.setItem('shadt_camas', JSON.stringify(beds));
  }

  // INICIALIZACIÓN GENERAL
  document.addEventListener('DOMContentLoaded', function () {
    // Inicializar camas
    initBeds();

    // Mostrar usuario en sidebar
    const spanUser = document.getElementById('shadt-username');
    if (spanUser) {
      try {
        const raw = localStorage.getItem('shadt_user');
        if (raw) {
          const user = JSON.parse(raw);
          if (user && user.nombre) {
            spanUser.textContent = user.nombre;
          }
        }
      } catch (e) {
        console.error('Error leyendo shadt_user', e);
      }
    }

    // Toggle de sidebar en móvil
    const btnToggle = document.getElementById('sidebarToggle');
    if (btnToggle) {
      btnToggle.addEventListener('click', function () {
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) {
          sidebar.classList.toggle('show');
        }
      });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
